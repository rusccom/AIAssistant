# DigitalOcean App Platform - Backend + Frontend + Widget
name: aiassistant

services:
# –ï–¥–∏–Ω—ã–π —Å–µ—Ä–≤–∏—Å –∫–æ—Ç–æ—Ä—ã–π –æ–±—Å–ª—É–∂–∏–≤–∞–µ—Ç API + Frontend + Widget
- name: web
  source_dir: /
  github:
    repo: your-username/AIAssistant-3
    branch: main
    deploy_on_push: true
  
  # –ö–æ–º–∞–Ω–¥—ã —Å–±–æ—Ä–∫–∏ - –±–∏–ª–¥–∏–º –≤—Å–µ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã
  build_command: |
    echo "üî® Installing dependencies..."
    npm run install-all
    echo "üèóÔ∏è  Building all components..."
    npm run build:all
    echo "üì¶ Build completed successfully!"
    ls -la backend/dist/
    ls -la frontend/dist/
    ls -la backend/public/widget/
  
  # –ó–∞–ø—É—Å–∫ backend —Å–µ—Ä–≤–µ—Ä–∞ (–∫–æ—Ç–æ—Ä—ã–π —Ä–∞–∑–¥–∞–µ—Ç API + —Å—Ç–∞—Ç–∏–∫—É)
  run_command: npm start
  
  # –ù–∞—Å—Ç—Ä–æ–π–∫–∏ Node.js
  environment_slug: node-js
  instance_count: 1
  instance_size_slug: basic-xxs
  http_port: 3001
  
  # –í—Å–µ routes –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞—é—Ç—Å—è –æ–¥–Ω–∏–º —Å–µ—Ä–≤–∏—Å–æ–º
  routes:
  - path: /
  
  # –ü–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è
  envs:
  - key: NODE_ENV
    value: production
  - key: DATABASE_URL
    type: SECRET
    # –£–∫–∞–∂–∏—Ç–µ URL –≤–∞—à–µ–π –≤–Ω–µ—à–Ω–µ–π –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö
  - key: OPENAI_API_KEY
    type: SECRET
    # –í–∞—à OpenAI –∫–ª—é—á
  - key: JWT_SECRET  
    type: SECRET
    # –°–∏–ª—å–Ω—ã–π —Å–µ–∫—Ä–µ—Ç –¥–ª—è JWT (32+ —Å–∏–º–≤–æ–ª–æ–≤)
  - key: ALLOWED_ORIGINS
    value: https://${_self.DOMAIN}
  - key: PORT
    value: "3001"
